<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Builder v70 Ultimate Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Pacifico&family=Ruslan+Display&family=Montserrat:wght@600;800&family=Press+Start+2P&family=Lobster&family=Comfortaa:wght@700&display=swap" rel="stylesheet">
<style>
/* --- –î–ò–ó–ê–ô–ù –†–ï–î–ê–ö–¢–û–†–ê --- */
:root { --primary: #6c5ce7; --bg-editor: #f4f7f6; --card-bg: #ffffff; --text-main: #2d3436; --text-muted: #636e72; --gradient: linear-gradient(135deg, #6c5ce7, #a29bfe); --panel-w: 430px; }
* { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
body { font-family: 'Roboto', sans-serif; height: 100vh; display: flex; overflow: hidden; background: #dfe6e9; }
.editor-panel { width: var(--panel-w); background: var(--bg-editor); border-right: 1px solid #dcdde1; display: flex; flex-direction: column; z-index: 10; box-shadow: 5px 0 15px rgba(0,0,0,0.05); }
.editor-header { padding: 20px; background: var(--gradient); color: #fff; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3); position: relative; }
.editor-header h2 { font-family: 'Montserrat', sans-serif; font-size: 15px; margin: 0; font-weight: 800; letter-spacing: 0.5px; text-transform: uppercase; display: flex; align-items: center; gap: 10px; }
.header-actions { position: absolute; top: 8px; right: 15px; display: flex; gap: 5px; }
.icon-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: #fff; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.2s; }
.icon-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }
.tabs { display: flex; background: #fff; padding: 0 10px; border-bottom: 1px solid #e0e0e0; }
.tab { flex: 1; text-align: center; padding: 15px 0; color: var(--text-muted); cursor: pointer; font-size: 11px; font-weight: 600; border-bottom: 3px solid transparent; transition: 0.3s; text-transform: uppercase; }
.tab:hover { color: var(--primary); background: #fdfdfd; }
.tab.active { color: var(--primary); border-bottom-color: var(--primary); }
.settings-content { flex: 1; overflow-y: auto; padding: 20px; }
.section { display: none; animation: fadeIn 0.3s; }
.section.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
.info-box { background: #e3f2fd; border-left: 4px solid #2196f3; color: #0d47a1; padding: 12px; border-radius: 4px; font-size: 12px; margin-bottom: 20px; line-height: 1.4; }
.warning-box { background: #fff3cd; border-left: 4px solid #ffc107; color: #856404; padding: 12px; border-radius: 4px; font-size: 12px; margin-bottom: 20px; line-height: 1.4; }
.form-group { margin-bottom: 15px; }
.form-group label { display: block; font-size: 11px; font-weight: 700; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
.file-upload-row { display: flex; gap: 5px; }
.file-upload-row input[type="text"] { flex: 1; border-top-right-radius: 0; border-bottom-right-radius: 0; }
input[type="file"] { display: none; }
.btn-upload { background: #dfe6e9; border: 2px solid #e6e6e6; border-left: none; border-top-right-radius: 8px; border-bottom-right-radius: 8px; padding: 0 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 15px; transition: 0.2s; }
.btn-upload:hover { background: #b2bec3; }
.btn-play { background: #27ae60; border: 2px solid #27ae60; border-left: none; color: #fff; border-radius: 0; padding: 0 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; transition: 0.2s; }
.btn-play:hover { background: #229954; }
.file-upload-row .btn-play { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
.form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px 12px; border: 2px solid #e6e6e6; border-radius: 8px; font-size: 14px; background: #fff; color: var(--text-main); transition: 0.2s; font-family: 'Roboto', sans-serif; }
.form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.1); }
.form-group input[type="color"] { height: 40px; padding: 2px; cursor: pointer; }
.form-group input[type="range"] { cursor: pointer; }
.form-group input[type="checkbox"] { width: auto; margin-right: 8px; }
.form-row { display: flex; gap: 10px; }
.btn-add { width: 100%; padding: 12px; background: #fff; border: 2px dashed var(--primary); color: var(--primary); border-radius: 8px; cursor: pointer; font-weight: 700; text-transform: uppercase; font-size: 13px; transition: 0.2s; }
.btn-add:hover { background: #f0f0ff; }
.editor-footer { padding: 20px; border-top: 1px solid #e0e0e0; background: #fff; }
.btn-generate { width: 100%; padding: 14px; background: var(--gradient); color: #fff; border: none; border-radius: 10px; font-size: 15px; font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4); transition: 0.2s; }
.btn-generate:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(108, 92, 231, 0.5); }
.btn-generate:active { transform: translateY(1px); }
.preview-area { flex: 1; background: #dfe6e9; padding: 20px; display: flex; align-items: center; justify-content: center; background-image: radial-gradient(#b2bec3 1px, transparent 1px); background-size: 20px 20px; }
#game-preview-container { width: 960px; height: 540px; background: #fff; box-shadow: 0 20px 60px rgba(0,0,0,0.15); border-radius: 12px; overflow: hidden; }
#game-frame { width: 100%; height: 100%; border: none; }
.modal-overlay { position: fixed; inset: 0; background: rgba(45, 52, 54, 0.9); z-index: 1000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
.code-modal { background: #fff; padding: 30px; border-radius: 16px; width: 600px; max-width: 90%; display: flex; flex-direction: column; gap: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
.code-modal h3 { font-family: 'Montserrat', sans-serif; color: var(--text-main); }
.code-modal textarea { width: 100%; height: 300px; font-family: 'Consolas', monospace; padding: 15px; font-size: 12px; background: #f1f2f6; border: none; border-radius: 8px; color: #2f3542; }
.modal-btns { display: flex; justify-content: flex-end; gap: 10px; }
.modal-btns button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
.btn-close { background: #dfe4ea; color: #2f3542; }
.btn-copy { background: var(--primary); color: #fff; }
.btn-reset { background: #e74c3c; color: #fff; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #b2bec3; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #636e72; }

.style-section { background: #fff; border: 2px solid #e6e6e6; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
.style-section-title { font-size: 12px; font-weight: 800; color: var(--primary); margin-bottom: 12px; text-transform: uppercase; display: flex; align-items: center; gap: 8px; border-bottom: 2px solid #f0f0f0; padding-bottom: 8px; }
.checkbox-group { display: flex; align-items: center; padding: 8px 0; }
.checkbox-group label { text-transform: none; margin: 0; font-size: 13px; }

.sound-item { background: #f8f9fa; border: 1px solid #e0e0e0; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
.sound-item-title { font-size: 11px; font-weight: 700; color: var(--primary); margin-bottom: 8px; text-transform: uppercase; }

.range-value { display: inline-block; min-width: 40px; text-align: center; font-weight: 700; color: var(--primary); }
</style>
</head>
<body>

<div class="editor-panel">
    <div class="editor-header">
        <h2><img src="https://img.genially.com/684ea2da1b51060014c50e97/7deba801-847c-4b43-b21f-889cb46a08d3.png" style="width: 48px; height: 48px; border-radius: 8px;"> –†–µ–¥–∞–∫—Ç–æ—Ä "–ü–æ–π–º–∞–π –ø—Ä–µ–¥–º–µ—Ç" v70</h2>
        <div class="header-actions">
            <button class="icon-btn" onclick="resetAll()" title="–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë">üîÑ</button>
        </div>
    </div>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('content')">–í–æ–ø—Ä–æ—Å—ã</div>
        <div class="tab" onclick="switchTab('graphics')">–ì—Ä–∞—Ñ–∏–∫–∞</div>
        <div class="tab" onclick="switchTab('style')">–°—Ç–∏–ª—å</div>
        <div class="tab" onclick="switchTab('text')">–¢–µ–∫—Å—Ç—ã</div>
        <div class="tab" onclick="switchTab('sounds')">–ó–≤—É–∫–∏</div>
        <div class="tab" onclick="switchTab('game')">–ò–≥—Ä–∞</div>
    </div>
    
    <div class="settings-content">
        <div id="tab-content" class="section active">
            <div class="info-box">üí° <b>–ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç:</b> –í—Å—Ç–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ—Å—Ç—Ä–æ—á–Ω–æ. –û—Ç–≤–µ—Ç—ã —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ —Å–∏–º–≤–æ–ª–æ–º <b>|</b></div>
            
            <div class="form-group">
                <label>üìù –í–æ–ø—Ä–æ—Å—ã (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)</label>
                <textarea id="bulk-questions" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä:&#10;–°—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏?&#10;2+2=?&#10;–¶–≤–µ—Ç –Ω–µ–±–∞?" oninput="debouncedUpdate()"></textarea>
            </div>
            
            <div class="form-group">
                <label style="color:#2ecc71;">‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (—á–µ—Ä–µ–∑ |)</label>
                <textarea id="bulk-correct" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä:&#10;–ú–æ—Å–∫–≤–∞ | –º–æ—Å–∫–≤–∞&#10;4 | —á–µ—Ç—ã—Ä–µ&#10;–°–∏–Ω–∏–π | –ì–æ–ª—É–±–æ–π" oninput="debouncedUpdate()"></textarea>
            </div>
            
            <div class="form-group">
                <label style="color:#e74c3c;">‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (—á–µ—Ä–µ–∑ |)</label>
                <textarea id="bulk-wrong" rows="4" placeholder="–ü—Ä–∏–º–µ—Ä:&#10;–ü–∏—Ç–µ—Ä | –ö–∞–∑–∞–Ω—å&#10;5 | 3&#10;–ó–µ–ª—ë–Ω—ã–π | –ö—Ä–∞—Å–Ω—ã–π" oninput="debouncedUpdate()"></textarea>
            </div>
        </div>
        
        <div id="tab-graphics" class="section">
            <div class="form-group"><label>–ì–µ—Ä–æ–π</label><div class="file-upload-row"><input type="text" id="img-hero" placeholder="–°—Å—ã–ª–∫–∞ –∏–ª–∏ —Ñ–∞–π–ª" oninput="clearCache('hero'); debouncedUpdate()"><label for="file-hero" class="btn-upload">üìÇ</label><input type="file" id="file-hero" accept="image/*" onchange="encodeImg(this, 'hero')"></div></div>
            <div class="form-group"><label>–ë–æ–º–±–∞ (–í—Ä–∞–≥)</label><div class="file-upload-row"><input type="text" id="img-bomb" placeholder="–°—Å—ã–ª–∫–∞ –∏–ª–∏ —Ñ–∞–π–ª" oninput="clearCache('bomb'); debouncedUpdate()"><label for="file-bomb" class="btn-upload">üìÇ</label><input type="file" id="file-bomb" accept="image/*" onchange="encodeImg(this, 'bomb')"></div></div>
            
            <div class="form-group" style="background:#e3f2fd; padding:10px; border-radius:8px; border:1px solid #90caf9;">
                <label style="color:#1565c0;">‚ù§Ô∏è –ñ–∏–∑–Ω–∏ (UI –∏ –ë–æ–Ω—É—Å)</label>
                <div class="file-upload-row">
                    <input type="text" id="img-life" placeholder="–°—Å—ã–ª–∫–∞ –∏–ª–∏ —Ñ–∞–π–ª" oninput="clearCache('life'); debouncedUpdate()">
                    <label for="file-life" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-life" accept="image/*" onchange="encodeImg(this, 'life')">
                </div>
            </div>
            
            <div class="form-group"><label>–ë–æ–Ω—É—Å: –ü—Ä–æ–≥—Ä–µ—Å—Å (+5 ‚≠ê)</label><div class="file-upload-row"><input type="text" id="img-bonus-score" oninput="clearCache('bscore'); debouncedUpdate()"><label for="file-bonus-score" class="btn-upload">üìÇ</label><input type="file" id="file-bonus-score" accept="image/*" onchange="encodeImg(this, 'bscore')"></div></div>

            <div class="info-box" style="margin-top:20px; background:#fff3cd; border-color:#ffc107; color:#856404;">‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b> –ö–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∏–∂–µ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è <b>—Å–ª—É—á–∞–π–Ω–æ</b> –¥–ª—è –ª—é–±–æ–≥–æ –æ—Ç–≤–µ—Ç–∞.</div>
            <div class="form-row">
                <div class="form-group" style="flex:1"><label>–°–∫–∏–Ω –ø—Ä–µ–¥–º–µ—Ç–∞ 1</label><div class="file-upload-row"><input type="text" id="img-skin1" oninput="clearCache('skin1'); debouncedUpdate()"><label for="file-skin1" class="btn-upload">üìÇ</label><input type="file" id="file-skin1" accept="image/*" onchange="encodeImg(this, 'skin1')"></div></div>
                <div class="form-group" style="flex:1"><label>–°–∫–∏–Ω –ø—Ä–µ–¥–º–µ—Ç–∞ 2</label><div class="file-upload-row"><input type="text" id="img-skin2" oninput="clearCache('skin2'); debouncedUpdate()"><label for="file-skin2" class="btn-upload">üìÇ</label><input type="file" id="file-skin2" accept="image/*" onchange="encodeImg(this, 'skin2')"></div></div>
            </div>
        </div>
        
        <div id="tab-style" class="section">
            <!-- –®–†–ò–§–¢–´ -->
            <div class="style-section">
                <div class="style-section-title">üî§ –®—Ä–∏—Ñ—Ç—ã</div>
                <div class="form-group"><label>–®—Ä–∏—Ñ—Ç –∏–≥—Ä—ã</label><select id="font-family" onchange="u()"><option value="Ruslan Display">Ruslan Display (–°—Ç–∏–ª—å–Ω—ã–π)</option><option value="Press Start 2P">Press Start 2P (–ü–∏–∫—Å–µ–ª—å–Ω—ã–π)</option><option value="Lobster">Lobster (–†—É–∫–æ–ø–∏—Å–Ω—ã–π)</option><option value="Comfortaa">Comfortaa (–û–∫—Ä—É–≥–ª—ã–π)</option><option value="Roboto">Roboto (–°—Ç–∞–Ω–¥–∞—Ä—Ç)</option><option value="Pacifico">Pacifico (–ö—É—Ä—Å–∏–≤)</option><option value="Arial">Arial</option></select></div>
                <div class="form-row">
                    <div class="form-group"><label>–†–∞–∑–º–µ—Ä –í–æ–ø—Ä–æ—Å–∞</label><input type="number" id="fs-q" value="28" onchange="u()"></div>
                    <div class="form-group"><label>–†–∞–∑–º–µ—Ä –û—Ç–≤–µ—Ç–∞</label><input type="number" id="fs-a" value="20" onchange="u()"></div>
                </div>
            </div>

            <!-- –†–ê–ó–ú–ï–†–´ -->
            <div class="style-section">
                <div class="style-section-title">üìê –†–∞–∑–º–µ—Ä—ã</div>
                <div class="form-group"><label>–†–∞–∑–º–µ—Ä –ì–ï–†–û–Ø: <span id="sd-hsize" class="range-value">150</span>px</label><input type="range" id="conf-hero-size" min="50" max="250" step="5" value="150" oninput="document.getElementById('sd-hsize').innerText=this.value;u()"></div>
                <div class="form-group"><label>–†–∞–∑–º–µ—Ä –û–¢–í–ï–¢–û–í: <span id="sd-size" class="range-value">70</span>px</label><input type="range" id="conf-size" min="40" max="150" step="5" value="70" oninput="document.getElementById('sd-size').innerText=this.value;u()"></div>
                <div class="form-group"><label>–†–∞–∑–º–µ—Ä –ë–û–ú–ë–´ / –ë–û–ù–£–°–û–í: <span id="sd-bsize" class="range-value">60</span>px</label><input type="range" id="conf-bomb-size" min="40" max="150" step="5" value="60" oninput="document.getElementById('sd-bsize').innerText=this.value;u()"></div>
                <div class="form-group"><label>‚ÜïÔ∏è –°–º–µ—â–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞: <span id="sd-pos" class="range-value">0</span>px</label><input type="range" id="conf-tpos" min="-50" max="50" step="2" value="0" oninput="document.getElementById('sd-pos').innerText=this.value;u()"></div>
            </div>

            <!-- –û–ö–ù–ê (–ú–û–î–ê–õ–ö–ò) -->
            <div class="style-section">
                <div class="style-section-title">ü™ü –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞</div>
                <div class="form-group"><label>üé® –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –æ–∫–Ω–∞</label><input type="color" id="col-win-bg" value="#1a1a1a" onchange="u()"></div>
                <div class="form-group"><label>üìù –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –æ–∫–Ω–∞</label><input type="color" id="col-win-text" value="#ffffff" onchange="u()"></div>
                <div class="form-group"><label>‚ú® –¶–≤–µ—Ç —Ä–∞–º–∫–∏ / –∫–Ω–æ–ø–∫–∏</label><input type="color" id="col-border" value="#a29bfe" onchange="u()"></div>
                <div class="checkbox-group">
                    <input type="checkbox" id="win-glow" checked onchange="u()">
                    <label for="win-glow">–í–∫–ª—é—á–∏—Ç—å –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ</label>
                </div>
            </div>

            <!-- –ü–†–û–ì–†–ï–°–° –ë–ê–† -->
            <div class="style-section">
                <div class="style-section-title">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä</div>
                <div class="form-row">
                    <div class="form-group" style="flex:1"><label>–ù–∞—á–∞–ª–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞</label><input type="color" id="col-p1" value="#9b59b6" onchange="u()"></div>
                    <div class="form-group" style="flex:1"><label>–ö–æ–Ω–µ—Ü –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞</label><input type="color" id="col-p2" value="#8e44ad" onchange="u()"></div>
                </div>
            </div>

            <!-- –í–û–ü–†–û–°–ù–ê–Ø –ü–ê–ù–ï–õ–¨ -->
            <div class="style-section">
                <div class="style-section-title">‚ùì –ü–∞–Ω–µ–ª—å –≤–æ–ø—Ä–æ—Å–∞</div>
                <div class="form-group"><label>üé® –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø–∞–Ω–µ–ª–∏</label><input type="color" id="col-qbox-bg" value="#111111" onchange="u()"></div>
                <div class="form-group"><label>üî§ –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞</label><input type="color" id="col-question-text" value="#ffffff" onchange="u()"></div>
            </div>

            <!-- –ü–†–ï–î–ú–ï–¢–´ -->
            <div class="style-section">
                <div class="style-section-title">üéØ –ü—Ä–µ–¥–º–µ—Ç—ã (–æ—Ç–≤–µ—Ç—ã)</div>
                <div class="form-row">
                    <div class="form-group" style="flex:1"><label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label><input type="color" id="col-lt" value="#ffffff" onchange="u()"></div>
                    <div class="form-group" style="flex:1"><label>–¶–≤–µ—Ç –ø–æ–¥–ª–æ–∂–∫–∏</label><input type="color" id="col-lb" value="#000000" onchange="u()"></div>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="item-transparent" onchange="u()">
                    <label for="item-transparent">–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ø–æ–¥–ª–æ–∂–∫–∞</label>
                </div>
            </div>
        </div>
        
        <div id="tab-text" class="section">
            <div class="form-group">
                <label>üåç –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–ø—Ä–µ—Å–µ—Ç)</label>
                <select id="lang-preset" onchange="applyLangPreset()">
                    <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
                    <option value="ru" selected>üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                    <option value="en">üá¨üáß English</option>
                    <option value="de">üá©üá™ Deutsch</option>
                    <option value="fr">üá´üá∑ Fran√ßais</option>
                    <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
                    <option value="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</option>
                </select>
            </div>
            <div class="form-group"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ–Ω—é</label><input type="text" id="tt" value="–ü–û–ô–ú–ê–ô –ü–†–ï–î–ú–ï–¢–´" onchange="u()"></div>
            <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ –º–µ–Ω—é</label><textarea id="td" rows="2" onchange="u()">–ò—Å–ø–æ–ª—å–∑—É–π ‚Üê –∏–ª–∏ ‚Üí —á—Ç–æ–±—ã –ø–æ–π–º–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ò–∑–±–µ–≥–∞–π –±–æ–º–± –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!</textarea></div>
            <div class="form-group"><label>–¢–µ–∫—Å—Ç –ü–æ–±–µ–¥—ã</label><input type="text" id="tw" value="–ü–û–ë–ï–î–ê!" onchange="u()"></div>
            <div class="form-group"><label>–¢–µ–∫—Å—Ç –ü–æ—Ä–∞–∂–µ–Ω–∏—è</label><input type="text" id="tl" value="–û–π!" onchange="u()"></div>
            
            <div class="style-section">
                <div class="style-section-title">üéØ –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫</div>
                <div class="form-group"><label>–ö–Ω–æ–ø–∫–∞ "–°—Ç–∞—Ä—Ç"</label><input type="text" id="btn-start" value="–ò–ì–†–ê–¢–¨" onchange="u()"></div>
                <div class="form-group"><label>–ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"</label><input type="text" id="btn-continue" value="–ü–†–û–î–û–õ–ñ–ò–¢–¨" onchange="u()"></div>
                <div class="form-group"><label>–ö–Ω–æ–ø–∫–∞ "–ü–æ–≤—Ç–æ—Ä"</label><input type="text" id="btn-retry" value="–ï–©–Å –†–ê–ó" onchange="u()"></div>
            </div>
        </div>

        <div id="tab-sounds" class="section">
            <div class="info-box">üîä <b>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–∏ –∑–≤—É–∫–∏</b> –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫–∏. –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∑–≤—É–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.</div>
            
            <div class="sound-item">
                <div class="sound-item-title">üí£ –ó–≤—É–∫ –±–æ–º–±—ã</div>
                <div class="file-upload-row">
                    <input type="text" id="snd-bomb" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ MP3/WAV" oninput="clearCache('sndbomb'); debouncedUpdate()">
                    <label for="file-snd-bomb" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-snd-bomb" accept="audio/*" onchange="encodeAudio(this, 'sndbomb')">
                    <button class="btn-play" onclick="previewSound('bomb')">‚ñ∂</button>
                </div>
            </div>

            <div class="sound-item">
                <div class="sound-item-title">‚úÖ –ó–≤—É–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞</div>
                <div class="file-upload-row">
                    <input type="text" id="snd-correct" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ MP3/WAV" oninput="clearCache('sndcorrect'); debouncedUpdate()">
                    <label for="file-snd-correct" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-snd-correct" accept="audio/*" onchange="encodeAudio(this, 'sndcorrect')">
                    <button class="btn-play" onclick="previewSound('correct')">‚ñ∂</button>
                </div>
            </div>

            <div class="sound-item">
                <div class="sound-item-title">‚ùå –ó–≤—É–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞</div>
                <div class="file-upload-row">
                    <input type="text" id="snd-wrong" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ MP3/WAV" oninput="clearCache('sndwrong'); debouncedUpdate()">
                    <label for="file-snd-wrong" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-snd-wrong" accept="audio/*" onchange="encodeAudio(this, 'sndwrong')">
                    <button class="btn-play" onclick="previewSound('wrong')">‚ñ∂</button>
                </div>
            </div>

            <div class="sound-item">
                <div class="sound-item-title">‚ù§Ô∏è –ó–≤—É–∫ –±–æ–Ω—É—Å–∞ –∂–∏–∑–Ω–∏</div>
                <div class="file-upload-row">
                    <input type="text" id="snd-life" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ MP3/WAV" oninput="clearCache('sndlife'); debouncedUpdate()">
                    <label for="file-snd-life" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-snd-life" accept="audio/*" onchange="encodeAudio(this, 'sndlife')">
                    <button class="btn-play" onclick="previewSound('life')">‚ñ∂</button>
                </div>
            </div>

            <div class="sound-item">
                <div class="sound-item-title">‚≠ê –ó–≤—É–∫ –±–æ–Ω—É—Å–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</div>
                <div class="file-upload-row">
                    <input type="text" id="snd-bonus" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ MP3/WAV" oninput="clearCache('sndbonus'); debouncedUpdate()">
                    <label for="file-snd-bonus" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-snd-bonus" accept="audio/*" onchange="encodeAudio(this, 'sndbonus')">
                    <button class="btn-play" onclick="previewSound('bonus')">‚ñ∂</button>
                </div>
            </div>

            <div class="sound-item">
                <div class="sound-item-title">üèÜ –ó–≤—É–∫ –ø–æ–±–µ–¥—ã</div>
                <div class="file-upload-row">
                    <input type="text" id="snd-win" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ MP3/WAV" oninput="clearCache('sndwin'); debouncedUpdate()">
                    <label for="file-snd-win" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-snd-win" accept="audio/*" onchange="encodeAudio(this, 'sndwin')">
                    <button class="btn-play" onclick="previewSound('win')">‚ñ∂</button>
                </div>
            </div>

            <div class="sound-item">
                <div class="sound-item-title">üò¢ –ó–≤—É–∫ –ø–æ—Ä–∞–∂–µ–Ω–∏—è</div>
                <div class="file-upload-row">
                    <input type="text" id="snd-lose" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ MP3/WAV" oninput="clearCache('sndlose'); debouncedUpdate()">
                    <label for="file-snd-lose" class="btn-upload">üìÇ</label>
                    <input type="file" id="file-snd-lose" accept="audio/*" onchange="encodeAudio(this, 'sndlose')">
                    <button class="btn-play" onclick="previewSound('lose')">‚ñ∂</button>
                </div>
            </div>
        </div>

        <div id="tab-game" class="section">
            <div class="info-box">üéÆ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏</b></div>
            
            <div class="style-section">
                <div class="style-section-title">‚ö° –ì–µ–π–º–ø–ª–µ–π</div>
                <div class="form-group"><label>–°–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è: <span id="sd-speed" class="range-value">2</span></label><input type="range" id="conf-speed" min="1" max="10" step="0.5" value="2" oninput="document.getElementById('sd-speed').innerText=this.value;u()"></div>
                <div class="form-group"><label>–ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (–º—Å): <span id="sd-freq" class="range-value">900</span></label><input type="range" id="conf-freq" min="300" max="2000" step="100" value="900" oninput="document.getElementById('sd-freq').innerText=this.value;u()"></div>
                <div class="form-group"><label>‚ù§Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–∑–Ω–µ–π: <span id="sd-lives" class="range-value">3</span></label><input type="range" id="conf-lives" min="1" max="10" step="1" value="3" oninput="document.getElementById('sd-lives').innerText=this.value;u()"></div>
            </div>

            <div class="style-section">
                <div class="style-section-title">üé≤ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è</div>
                <div class="form-group"><label>üí£ –ë–æ–º–±—ã: <span id="sd-prob-bomb" class="range-value">15</span>%</label><input type="range" id="prob-bomb" min="0" max="50" step="1" value="15" oninput="document.getElementById('sd-prob-bomb').innerText=this.value;u()"></div>
                <div class="form-group"><label>‚ù§Ô∏è –ë–æ–Ω—É—Å –∂–∏–∑–Ω–∏: <span id="sd-prob-life" class="range-value">5</span>%</label><input type="range" id="prob-life" min="0" max="30" step="1" value="5" oninput="document.getElementById('sd-prob-life').innerText=this.value;u()"></div>
                <div class="form-group"><label>‚≠ê –ë–æ–Ω—É—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞: <span id="sd-prob-score" class="range-value">5</span>%</label><input type="range" id="prob-score" min="0" max="30" step="1" value="5" oninput="document.getElementById('sd-prob-score').innerText=this.value;u()"></div>
            </div>

            <div class="style-section">
                <div class="style-section-title">üì± –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</div>
                <div class="checkbox-group">
                    <input type="checkbox" id="mobile-controls" checked onchange="u()">
                    <label for="mobile-controls">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (‚Üê ‚Üí)</label>
                </div>
            </div>
        </div>
    </div>
    
    <div class="editor-footer"><button class="btn-generate" onclick="gen()">üöÄ –ü–û–õ–£–ß–ò–¢–¨ –ö–û–î</button></div>
</div>
<div class="preview-area"><div id="game-preview-container"><iframe id="game-frame"></iframe></div></div>
<div id="modal-code" class="modal-overlay"><div class="code-modal"><h3>üéâ –ö–æ–¥ –≥–æ—Ç–æ–≤!</h3><p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –≤ Genially (Insert -> Others).</p><textarea id="final-code" readonly></textarea><div class="modal-btns"><button class="btn-close" onclick="document.getElementById('modal-code').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button><button class="btn-copy" onclick="copy()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div></div></div>

<input type="file" id="config-file-import" accept=".json" style="display:none" onchange="handleConfigImport(this)">

<script>
const def={
    h:"https://img.genially.com/684ea2da1b51060014c50e97/4e2c4c8a-5a17-4c32-95e1-7cc360b44a84.png",
    b:"https://img.genially.com/684ea2da1b51060014c50e97/91910846-d855-4c4b-8561-5ff0edaa87ad.png",
    l:"https://img.genially.com/684ea2da1b51060014c50e97/56159391-2288-48d7-8264-2e7f0aa2f799.gif",
    sk1:"https://img.genially.com/684ea2da1b51060014c50e97/33b8d640-53fd-4b63-b5df-f7df01a72b2f.png",
    sk2:"https://img.genially.com/684ea2da1b51060014c50e97/5857090c-baea-4b09-bb56-cda2472b1b19.png",
    bscore:"https://img.genially.com/684ea2da1b51060014c50e97/516bf8aa-cb50-433c-98ed-500cc8bb4696.png"
};

const langPresets = {
    ru: { title: "–ü–û–ô–ú–ê–ô –ü–†–ï–î–ú–ï–¢–´", desc: "–ò—Å–ø–æ–ª—å–∑—É–π ‚Üê –∏–ª–∏ ‚Üí —á—Ç–æ–±—ã –ø–æ–π–º–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã. –ò–∑–±–µ–≥–∞–π –±–æ–º–± –∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤!", win: "–ü–û–ë–ï–î–ê!", lose: "–û–π!", btnStart: "–ò–ì–†–ê–¢–¨", btnContinue: "–ü–†–û–î–û–õ–ñ–ò–¢–¨", btnRetry: "–ï–©–Å –†–ê–ó" },
    en: { title: "CATCH THE ITEMS", desc: "Use ‚Üê or ‚Üí to catch the correct answers. Avoid bombs and wrong answers!", win: "VICTORY!", lose: "Oops!", btnStart: "PLAY", btnContinue: "CONTINUE", btnRetry: "TRY AGAIN" },
    de: { title: "FANGE DIE GEGENST√ÑNDE", desc: "Benutze ‚Üê oder ‚Üí, um die richtigen Antworten zu fangen. Vermeide Bomben und falsche Antworten!", win: "SIEG!", lose: "Hoppla!", btnStart: "SPIELEN", btnContinue: "WEITER", btnRetry: "NOCHMAL" },
    fr: { title: "ATTRAPE LES OBJETS", desc: "Utilise ‚Üê ou ‚Üí pour attraper les bonnes r√©ponses. √âvite les bombes et les mauvaises r√©ponses!", win: "VICTOIRE!", lose: "Oups!", btnStart: "JOUER", btnContinue: "CONTINUER", btnRetry: "R√âESSAYER" },
    zh: { title: "Êé•‰ΩèÁâ©ÂìÅ", desc: "‰ΩøÁî® ‚Üê Êàñ ‚Üí Êé•‰ΩèÊ≠£Á°ÆÁ≠îÊ°à„ÄÇÈÅøÂºÄÁÇ∏ÂºπÂíåÈîôËØØÁ≠îÊ°àÔºÅ", win: "ËÉúÂà©ÔºÅ", lose: "ÂìéÂëÄÔºÅ", btnStart: "ÂºÄÂßã", btnContinue: "ÁªßÁª≠", btnRetry: "ÂÜçËØï‰∏ÄÊ¨°" },
    ko: { title: "ÏïÑÏù¥ÌÖú Ïû°Í∏∞", desc: "‚Üê ÎòêÎäî ‚ÜíÎ•º ÏÇ¨Ïö©ÌïòÏó¨ Ï†ïÎãµÏùÑ Ïû°ÏúºÏÑ∏Ïöî. Ìè≠ÌÉÑÍ≥º Ïò§ÎãµÏùÑ ÌîºÌïòÏÑ∏Ïöî!", win: "ÏäπÎ¶¨!", lose: "Ïïó!", btnStart: "ÏãúÏûë", btnContinue: "Í≥ÑÏÜç", btnRetry: "Îã§Ïãú ÏãúÎèÑ" }
};

const fontImports = {
    "Roboto": "@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap');",
    "Pacifico": "@import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');",
    "Ruslan Display": "@import url('https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap');",
    "Press Start 2P": "@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');",
    "Lobster": "@import url('https://fonts.googleapis.com/css2?family=Lobster&display=swap');",
    "Comfortaa": "@import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap');",
    "Arial": ""
};

let imgCache = { hero: null, bomb: null, life: null, skin1: null, skin2: null, bscore: null };
let audioCache = { sndbomb: null, sndcorrect: null, sndwrong: null, sndlife: null, sndbonus: null, sndwin: null, sndlose: null };
let updateTimeout = null;
let previewAudio = {};

// DEBOUNCE –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
function debouncedUpdate() {
    clearTimeout(updateTimeout);
    updateTimeout = setTimeout(() => {
        u();
        saveToLocalStorage();
    }, 300);
}

// LOCALSTORAGE
function saveToLocalStorage() {
    try {
        const config = getCfg();
        localStorage.setItem('gameBuilderConfig', JSON.stringify(config));
    } catch (e) {
        console.warn('Could not save to localStorage:', e);
    }
}

function loadFromLocalStorage() {
    try {
        const saved = localStorage.getItem('gameBuilderConfig');
        if (saved) {
            const config = JSON.parse(saved);
            applyConfig(config);
        }
    } catch (e) {
        console.warn('Could not load from localStorage:', e);
    }
}

function applyConfig(c) {
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    if (c.qs && c.qs.length > 0) {
        document.getElementById('bulk-questions').value = c.qs.map(q => q.text).join('\n');
        document.getElementById('bulk-correct').value = c.qs.map(q => q.correct.join(' | ')).join('\n');
        document.getElementById('bulk-wrong').value = c.qs.map(q => q.wrong.join(' | ')).join('\n');
    }
    if (c.h) document.getElementById('img-hero').value = c.h;
    if (c.b) document.getElementById('img-bomb').value = c.b;
    if (c.l) document.getElementById('img-life').value = c.l;
    if (c.i1) document.getElementById('img-skin1').value = c.i1;
    if (c.i2) document.getElementById('img-skin2').value = c.i2;
    if (c.bsc) document.getElementById('img-bonus-score').value = c.bsc;
    if (c.sp) document.getElementById('conf-speed').value = c.sp;
    if (c.fr) document.getElementById('conf-freq').value = c.fr;
    if (c.lives) document.getElementById('conf-lives').value = c.lives;
    if (c.fn) document.getElementById('font-family').value = c.fn;
    if (c.fq) document.getElementById('fs-q').value = c.fq;
    if (c.fa) document.getElementById('fs-a').value = c.fa;
    if (c.btnStart) document.getElementById('btn-start').value = c.btnStart;
    if (c.btnContinue) document.getElementById('btn-continue').value = c.btnContinue;
    if (c.btnRetry) document.getElementById('btn-retry').value = c.btnRetry;
    // ... –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
    u();
}

// –≠–ö–°–ü–û–†–¢/–ò–ú–ü–û–†–¢
function exportConfig() {
    const config = getCfg();
    const json = JSON.stringify(config, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'game-config.json';
    a.click();
    URL.revokeObjectURL(url);
}

function importConfig() {
    document.getElementById('config-file-import').click();
}

function handleConfigImport(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const config = JSON.parse(e.target.result);
                applyConfig(config);
                alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ' + err.message);
            }
        };
        reader.readAsText(file);
    }
}

// –°–ë–†–û–°
function resetAll() {
    if (confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç —Å–±—Ä–æ—à–µ–Ω—ã!')) {
        localStorage.removeItem('gameBuilderConfig');
        location.reload();
    }
}

// –ü–†–ï–î–ü–†–û–°–ú–û–¢–† –ó–í–£–ö–ê
function previewSound(type) {
    const input = document.getElementById('snd-' + type);
    const url = audioCache['snd' + type] || input.value;
    
    if (!url) {
        alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∑–≤—É–∫!');
        return;
    }
    
    if (previewAudio[type]) {
        previewAudio[type].pause();
        previewAudio[type].currentTime = 0;
    }
    
    previewAudio[type] = new Audio(url);
    previewAudio[type].play().catch(e => alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –∑–≤—É–∫'));
}

window.onload=()=>{
    document.getElementById('img-hero').value=def.h;
    document.getElementById('img-bomb').value=def.b;
    document.getElementById('img-life').value=def.l;
    document.getElementById('img-skin1').value=def.sk1;
    document.getElementById('img-skin2').value=def.sk2;
    document.getElementById('img-bonus-score').value=def.bscore;
    
    document.getElementById('bulk-questions').value = "–°—Ç–æ–ª–∏—Ü–∞ –†–æ—Å—Å–∏–∏?\n2+2=?\n–¶–≤–µ—Ç –Ω–µ–±–∞?";
    document.getElementById('bulk-correct').value = "–ú–æ—Å–∫–≤–∞ | –º–æ—Å–∫–≤–∞\n4 | —á–µ—Ç—ã—Ä–µ\n–°–∏–Ω–∏–π | –ì–æ–ª—É–±–æ–π";
    document.getElementById('bulk-wrong').value = "–ü–∏—Ç–µ—Ä | –ö–∞–∑–∞–Ω—å\n5 | 3\n–ó–µ–ª—ë–Ω—ã–π | –ö—Ä–∞—Å–Ω—ã–π";
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    if (!document.getElementById('btn-start').value) document.getElementById('btn-start').value = "–ò–ì–†–ê–¢–¨";
    if (!document.getElementById('btn-continue').value) document.getElementById('btn-continue').value = "–ü–†–û–î–û–õ–ñ–ò–¢–¨";
    if (!document.getElementById('btn-retry').value) document.getElementById('btn-retry').value = "–ï–©–Å –†–ê–ó";
    
    loadFromLocalStorage();
    u();
};

function switchTab(id){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById('tab-'+id).classList.add('active');
}

function applyLangPreset() {
    const lang = document.getElementById('lang-preset').value;
    if (lang === 'custom') return;
    const preset = langPresets[lang];
    document.getElementById('tt').value = preset.title;
    document.getElementById('td').value = preset.desc;
    document.getElementById('tw').value = preset.win;
    document.getElementById('tl').value = preset.lose;
    document.getElementById('btn-start').value = preset.btnStart;
    document.getElementById('btn-continue').value = preset.btnContinue;
    document.getElementById('btn-retry').value = preset.btnRetry;
    u();
}

function encodeImg(input, key) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            imgCache[key] = e.target.result; 
            document.getElementById('img-' + key).value = "(–ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞)";
            u();
            saveToLocalStorage();
        }
        reader.readAsDataURL(file);
    }
}

function encodeAudio(input, key) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            audioCache[key] = e.target.result;
            document.getElementById('snd-' + key.replace('snd', '')).value = "(–ó–≤—É–∫ –∑–∞–≥—Ä—É–∂–µ–Ω)";
            u();
            saveToLocalStorage();
        }
        reader.readAsDataURL(file);
    }
}

function clearCache(key) { 
    if (key.startsWith('snd')) {
        audioCache[key] = null;
    } else {
        imgCache[key] = null;
    }
}

function getCfg(){
    const questions = document.getElementById('bulk-questions').value.split('\n').filter(q => q.trim());
    const correct = document.getElementById('bulk-correct').value.split('\n').filter(c => c.trim());
    const wrong = document.getElementById('bulk-wrong').value.split('\n').filter(w => w.trim());
    
    const qs = [];
    for (let i = 0; i < questions.length; i++) {
        const c = (correct[i] || '').split('|').map(s => s.trim()).filter(s => s);
        const w = (wrong[i] || '').split('|').map(s => s.trim()).filter(s => s);
        
        // –í–ê–õ–ò–î–ê–¶–ò–Ø: –ø—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        if (questions[i].trim() && c.length > 0) {
            qs.push({
                text: questions[i].trim(),
                correct: c,
                wrong: w.length > 0 ? w : ['???'] // –ï—Å–ª–∏ –Ω–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–ª—É—à–∫—É
            });
        }
    }
    
    const lifeImg = imgCache.life || document.getElementById('img-life').value;
    
    return {
        sp: document.getElementById('conf-speed').value,
        fr: document.getElementById('conf-freq').value,
        lives: document.getElementById('conf-lives').value,
        h: imgCache.hero || document.getElementById('img-hero').value,
        b: imgCache.bomb || document.getElementById('img-bomb').value, 
        l: lifeImg,
        i1: imgCache.skin1 || document.getElementById('img-skin1').value,
        i2: imgCache.skin2 || document.getElementById('img-skin2').value,
        bli: lifeImg,
        bsc: imgCache.bscore || document.getElementById('img-bonus-score').value,
        isz: document.getElementById('conf-size').value,
        hsz: document.getElementById('conf-hero-size').value,
        bsz: document.getElementById('conf-bomb-size').value,
        tpos: document.getElementById('conf-tpos').value,
        qs: qs,
        fn: document.getElementById('font-family').value,
        fq: document.getElementById('fs-q').value,
        fa: document.getElementById('fs-a').value,
        bc: document.getElementById('col-border').value,
        wbg: document.getElementById('col-win-bg').value,
        wtxt: document.getElementById('col-win-text').value,
        wglow: document.getElementById('win-glow').checked,
        p1: document.getElementById('col-p1').value,
        p2: document.getElementById('col-p2').value,
        qtxt: document.getElementById('col-question-text').value,
        qboxbg: document.getElementById('col-qbox-bg').value,
        cl: document.getElementById('col-lt').value,
        lb: document.getElementById('col-lb').value,
        itrans: document.getElementById('item-transparent').checked,
        tt: document.getElementById('tt').value,
        td: document.getElementById('td').value,
        tw: document.getElementById('tw').value,
        tl: document.getElementById('tl').value,
        btnStart: document.getElementById('btn-start').value,
        btnContinue: document.getElementById('btn-continue').value,
        btnRetry: document.getElementById('btn-retry').value,
        probBomb: document.getElementById('prob-bomb').value,
        probLife: document.getElementById('prob-life').value,
        probScore: document.getElementById('prob-score').value,
        mobileControls: document.getElementById('mobile-controls').checked,
        sndbomb: audioCache.sndbomb || document.getElementById('snd-bomb').value || '',
        sndcorrect: audioCache.sndcorrect || document.getElementById('snd-correct').value || '',
        sndwrong: audioCache.sndwrong || document.getElementById('snd-wrong').value || '',
        sndlife: audioCache.sndlife || document.getElementById('snd-life').value || '',
        sndbonus: audioCache.sndbonus || document.getElementById('snd-bonus').value || '',
        sndwin: audioCache.sndwin || document.getElementById('snd-win').value || '',
        sndlose: audioCache.sndlose || document.getElementById('snd-lose').value || ''
    };
}

function u(){
    const c=getCfg();
    
    // –í–ê–õ–ò–î–ê–¶–ò–Ø
    if (c.qs.length === 0) {
        console.warn('No valid questions');
        return;
    }
    
    const h=build(c);
    document.getElementById('game-frame').src=URL.createObjectURL(new Blob([h],{type:'text/html'}));
}

function gen(){
    const c=getCfg();
    if (c.qs.length === 0) {
        alert('‚ö†Ô∏è –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏!');
        return;
    }
    document.getElementById('final-code').value=build(c);
    document.getElementById('modal-code').style.display='flex';
}

function copy(){
    const t=document.getElementById("final-code");
    t.select();
    document.execCommand("copy");
    alert("‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
}

function build(c){
    const fontImport = fontImports[c.fn] || "";
    const qs = JSON.stringify(c.qs);
    const glowStyle = c.wglow ? `box-shadow: 0 0 30px var(--c), inset 0 0 30px rgba(0,0,0,0.6);` : `box-shadow: none;`;
    const itemBgStyle = c.itrans ? `background: transparent;` : `background: var(--lb);`;
    const mobileControlsHTML = c.mobileControls ? `<div id="MC"><button class="mc-btn" id="MCL">‚Üê</button><button class="mc-btn" id="MCR">‚Üí</button></div>` : '';
    const mobileControlsCSS = c.mobileControls ? `#MC{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:none;gap:20px;z-index:15}@media (max-width:768px),(pointer:coarse){#MC{display:flex}}.mc-btn{width:70px;height:70px;border-radius:50%;background:rgba(108,92,231,0.8);border:3px solid #fff;color:#fff;font-size:32px;font-weight:700;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.3);transition:0.1s}.mc-btn:active{transform:scale(0.9);background:rgba(108,92,231,1)}` : '';
    
    // –í—ã—á–∏—Å–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    const pBomb = parseFloat(c.probBomb) / 100;
    const pLife = parseFloat(c.probLife) / 100;
    const pScore = parseFloat(c.probScore) / 100;
    const pCorrect = 0.4; // 40% –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
    const pWrong = 1 - (pBomb + pLife + pScore + pCorrect); // –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
    
    let html = `<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
${fontImport}
*{box-sizing:border-box;margin:0;padding:0;user-select:none;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;background:transparent;
    font-family:'${c.fn}',sans-serif !important; margin:0;padding:0;overflow:hidden}
#GC{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;touch-action:none}
:root{
    --c:${c.bc};--bg:${c.wbg};--wtxt:${c.wtxt};--p1:${c.p1};--p2:${c.p2};
    --fq:${c.fq}px;--fa:${c.fa}px;--cl:${c.cl};--lb:${c.lb};--qtxt:${c.qtxt};--qboxbg:${c.qboxbg};
    --isz:${c.isz}px; --bsz:${c.bsz}px; --hsz:${c.hsz}px; --tpos:${c.tpos}px; 
}
#UI{position:absolute;top:0;left:0;width:100%;padding:50px 30px;z-index:10;display:flex;flex-direction:column;gap:10px;pointer-events:none}
.tb{display:flex;align-items:center;justify-content:center;gap:15px;pointer-events:auto}
#PB{width:40px;height:40px;border-radius:50%;border:2px solid #fff;background:var(--c);color:#fff;font-weight:700;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:0.1s;touch-action:manipulation}
#PB:active{transform:scale(0.9)}
.pc{flex:1;max-width:600px;height:20px;background:rgba(0,0,0,0.5);border:2px solid rgba(255,255,255,0.8);border-radius:10px;overflow:hidden}
.pf{height:100%;background:linear-gradient(90deg,var(--p1),var(--p2));width:0%;transition:width 0.5s ease}
#QB{background:var(--qboxbg);border:2px solid var(--c);box-shadow:0 0 10px var(--c);color:var(--qtxt);border-radius:18px;padding:18px 24px;text-align:center;max-width:820px;margin:0 auto;box-sizing:border-box;pointer-events:auto;animation:pi .5s}
#QT{font-size:var(--fq);color:var(--qtxt);font-weight:700;text-shadow:0 0 5px var(--c); font-family:'${c.fn}',sans-serif !important;}
#LB{position:absolute;top:80px;right:20px;display:flex;gap:10px;pointer-events:none}
.h{width:50px;height:50px;background-size:contain;background-repeat:no-repeat;background-position:center;display:inline-block;filter:drop-shadow(0 2px 2px rgba(0,0,0,0.3))}
.h.br{animation:hba 2.5s forwards ease-out;z-index:100;position:relative}
@keyframes hba{0%{transform:scale(1);filter:brightness(1)}10%{transform:scale(1.1) rotate(-5deg);filter:brightness(2) sepia(1)}100%{transform:translateY(-150px) scale(1.2) rotate(-20deg);opacity:0}}

#H{
    position:absolute;bottom:30px;
    width:var(--hsz); height:var(--hsz); 
    background-repeat:no-repeat;background-position:center;background-size:contain;
    transform-origin:center bottom;transition:transform 0.1s linear;z-index:5
}

.f{
    position:absolute;top:-100px; display:flex;justify-content:center;align-items:center; 
    background-size:contain;background-repeat:no-repeat;background-position:center;
    will-change:top;z-index:4;
}
.f.is-bomb, .f.is-bonus { width: var(--bsz); height: var(--bsz); }
.f.is-answer { width: var(--isz); height: var(--isz); }

.il{
    ${itemBgStyle}color:var(--cl); padding:4px 8px;border-radius:4px;
    font-size:var(--fa);font-weight:700; white-space:nowrap;
    text-shadow:0 0 2px #000;border:1px solid #ffffff50;
    position: relative; top: var(--tpos); 
    font-family:'${c.fn}',sans-serif !important;
}

${mobileControlsCSS}

.cf{position:absolute;width:10px;height:10px;background:#f00;top:-10px;z-index:25;pointer-events:none;opacity:0}
@keyframes cfa{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
.ss{animation:sha 0.5s}
@keyframes sha{0%{transform:translate(1px,1px)}10%{transform:translate(-1px,-2px) rotate(-1deg)}30%{transform:translate(3px,2px)}50%{transform:translate(-1px,2px) rotate(-1deg)}70%{transform:translate(3px,1px) rotate(-1deg)}90%{transform:translate(1px,2px)}100%{transform:translate(1px,-2px) rotate(-1deg)}}
.ov{position:absolute;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:20;transition:0.3s;padding:50px 30px !important;box-sizing:border-box !important;min-height:100vh !important}
.ov.hd{opacity:0;pointer-events:none}

.md {
  background: var(--bg); border: 3px solid var(--c);
  ${glowStyle}
  border-radius: 25px !important; width: 75% !important; max-width: 580px !important; height: auto !important; max-height: 70vh !important;
  overflow-y: auto; box-sizing: border-box !important; padding: 38px 35px !important; margin: auto !important; color: var(--wtxt);
  display: flex !important; flex-direction: column !important; align-items: center !important; text-align: center !important; position: relative !important; transform: translateY(-80px) scale(0.98) !important; 
}
.md h1 { color: var(--wtxt); margin: 0 0 10px 0; font-size: 24px; text-transform: uppercase; text-shadow: 0 0 10px var(--c); width: 100%; font-family:'${c.fn}',sans-serif !important; }
.md p { color: var(--wtxt); font-size: 15px; margin: 0 0 20px 0; white-space: pre-line; line-height: 1.5; width: 100%; font-family:'${c.fn}',sans-serif !important; opacity: 0.9; }
.game-btn {
  display: flex; align-items: center; justify-content: center;
  width: auto; max-width: 250px; min-width: 160px; height: 46px; padding: 0 30px;
  background: var(--c); border-radius: 50px; color: #fff; font-weight: 800; font-size: 15px;
  text-transform: uppercase; cursor: pointer; box-shadow: 0 0 15px var(--c);
  transition: all 0.1s; user-select: none; border: 2px solid #fff; line-height: 1 !important; 
  font-family:'${c.fn}',sans-serif !important; touch-action:manipulation;
}
.game-btn:hover { transform: scale(1.05); box-shadow: 0 0 25px var(--c); }
.game-btn:active { transform: scale(0.95); }
.ft{position:absolute;font-weight:700;font-size:24px;pointer-events:none;animation:fu 1s forwards;z-index:15;text-shadow:2px 2px 0 #000; font-family:'${c.fn}',sans-serif !important;}
@keyframes fu{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-50px)}}
@keyframes pi{0%{transform:scale(0.8);opacity:0}100%{transform:scale(1);opacity:1}}
</style>
</head>
<body><div id="GC"><div id="UI"><div class="tb"><button id="PB">||</button><div class="pc"><div id="PF" class="pf"></div></div></div><div id="LB"></div><div id="QB"><div id="QT">...</div></div></div><div id="H"></div>${mobileControlsHTML}<div id="O" class="ov"><div class="md"><h1 id="OT"></h1><p id="OD"></p><div id="OB" class="game-btn">OK</div></div></div></div>
<script>
(function(){
const C={
    li:"${c.l}",hi:"${c.h}",bi:"${c.b}",i1:"${c.i1}",i2:"${c.i2}",bli:"${c.bli}",bsc:"${c.bsc}",
    hs:6,fs:${c.sp},si:${c.fr},ml:${c.lives},qs:${qs},tx:{t:"${c.tt}",d:"${c.td}",w:"${c.tw}",l:"${c.tl}",bs:"${c.btnStart || '–ò–ì–†–ê–¢–¨'}",bc:"${c.btnContinue || '–ü–†–û–î–û–õ–ñ–ò–¢–¨'}",br:"${c.btnRetry || '–ï–©–Å –†–ê–ó'}"},
    prob:{b:${pBomb},l:${pLife},s:${pScore},c:${pCorrect},w:${pWrong}},
    snd:{
        bomb:"${c.sndbomb}",correct:"${c.sndcorrect}",wrong:"${c.sndwrong}",
        life:"${c.sndlife}",bonus:"${c.sndbonus}",win:"${c.sndwin}",lose:"${c.sndlose}"
    }
};
let s={rn:0,pa:0,qi:0,lv:C.ml,hx:0,hf:0,ao:[],lt:0,tm:0,af:0,k:{l:0,r:0},bp:0}; 
const D=document,E={c:D.getElementById('GC'),h:D.getElementById('H'),l:D.getElementById('LB'),qt:D.getElementById('QT'),pf:D.getElementById('PF'),o:D.getElementById('O'),ot:D.getElementById('OT'),od:D.getElementById('OD'),ob:D.getElementById('OB'),pb:D.getElementById('PB')};

const AC = window.AudioContext || window.webkitAudioContext;
const ac = new AC();

const customAudio = {};
function loadCustomSound(key, src) {
    if (!src) return;
    customAudio[key] = new Audio(src);
    customAudio[key].preload = 'auto';
}
loadCustomSound('bomb', C.snd.bomb);
loadCustomSound('correct', C.snd.correct);
loadCustomSound('wrong', C.snd.wrong);
loadCustomSound('life', C.snd.life);
loadCustomSound('bonus', C.snd.bonus);
loadCustomSound('win', C.snd.win);
loadCustomSound('lose', C.snd.lose);

function playCustom(key) {
    if (customAudio[key]) {
        customAudio[key].currentTime = 0;
        customAudio[key].play().catch(e => console.log('Audio play failed:', e));
        return true;
    }
    return false;
}

function tone(type, freq, dur, vol=0.1) {
    if(ac.state === 'suspended') ac.resume();
    const o = ac.createOscillator(); const g = ac.createGain();
    o.type = type; o.frequency.setValueAtTime(freq, ac.currentTime);
    g.gain.setValueAtTime(vol, ac.currentTime); g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime + dur);
    o.connect(g); g.connect(ac.destination); o.start(); o.stop(ac.currentTime + dur);
}
function playLife() {
    if (playCustom('life')) return;
    if(ac.state === 'suspended') ac.resume();
    const o = ac.createOscillator(); const g = ac.createGain();
    o.type = 'sine'; 
    o.frequency.setValueAtTime(400, ac.currentTime);
    o.frequency.linearRampToValueAtTime(1000, ac.currentTime + 0.3);
    g.gain.setValueAtTime(0.3, ac.currentTime); 
    g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime + 0.3);
    o.connect(g); g.connect(ac.destination); o.start(); o.stop(ac.currentTime + 0.3);
}
function playBonus() {
    if (playCustom('bonus')) return;
    if(ac.state === 'suspended') ac.resume();
    const o = ac.createOscillator(); const g = ac.createGain();
    o.type = 'square'; 
    o.frequency.setValueAtTime(1200, ac.currentTime);
    o.frequency.linearRampToValueAtTime(1800, ac.currentTime + 0.1);
    g.gain.setValueAtTime(0.1, ac.currentTime); // üîß –ò–°–ü–†–ê–í–õ–ï–ù –ë–ê–ì!
    g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime + 0.1);
    o.connect(g); g.connect(ac.destination); o.start(); o.stop(ac.currentTime + 0.1);
}
function playBoom() {
    if (playCustom('bomb')) return;
    if(ac.state === 'suspended') ac.resume();
    const b = ac.createBuffer(1, ac.sampleRate * 0.5, ac.sampleRate); const d = b.getChannelData(0);
    for(let i=0; i<b.length; i++) d[i] = Math.random() * 2 - 1;
    const n = ac.createBufferSource(); n.buffer = b;
    const f = ac.createBiquadFilter(); f.type = 'lowpass'; f.frequency.value = 800; f.frequency.linearRampToValueAtTime(0, ac.currentTime + 0.5);
    const g = ac.createGain(); g.gain.setValueAtTime(1, ac.currentTime); g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime + 0.5);
    n.connect(f); f.connect(g); g.connect(ac.destination); n.start();
}
function playWin() {
    if (playCustom('win')) return;
    [523.25, 659.25, 783.99, 1046.50].forEach((f, i) => setTimeout(() => tone('square', f, 0.3, 0.1), i * 100));
}
function playLose() {
    if (playCustom('lose')) return;
    if(ac.state === 'suspended') ac.resume();
    const o = ac.createOscillator(); const g = ac.createGain();
    o.type = 'sawtooth'; o.frequency.setValueAtTime(200, ac.currentTime); o.frequency.linearRampToValueAtTime(50, ac.currentTime + 1);
    g.gain.setValueAtTime(0.2, ac.currentTime); g.gain.linearRampToValueAtTime(0, ac.currentTime + 1);
    o.connect(g); g.connect(ac.destination); o.start(); o.stop(ac.currentTime + 1);
}
function playCorrect() {
    if (playCustom('correct')) return;
    tone('sine', 1046.5, 0.1);
    setTimeout(() => tone('sine', 1568, 0.2), 100);
}
function playWrong() {
    if (playCustom('wrong')) return;
    tone('sawtooth', 150, 0.3, 0.2);
}

function ps(k) {
    if (k === 'b') playBoom();
    else if (k === 'c') playCorrect();
    else if (k === 'w') playWrong();
    else if (k === 'l') playLose();
    else if (k === 'win') playWin();
    else if (k === 'life') playLife();
    else if (k === 'bonus') playBonus();
}

function I(){E.h.style.backgroundImage='url("'+C.hi+'")';ev();rs();uu(1);so(0);}
function so(m){E.o.classList.remove('hd');if(m===0){stt(C.tx.t,C.tx.d,C.tx.bs,sg);}else if(m===1){stt("–ü–∞—É–∑–∞","–ò–≥—Ä–∞ –Ω–∞ –ø–∞—É–∑–µ",C.tx.bc,tp);}else if(m===2){stt(C.tx.l,"",C.tx.br,sg);ps('l');}else if(m===3){stt(C.tx.w,"",C.tx.br,sg);ps('win');fc();}}
function stt(t,d,b,f){ E.ot.innerText=t;E.od.innerText=d;E.ob.innerText=b; E.ob.onclick = () => { if(ac.state === 'suspended') ac.resume(); f(); }; }
function ho(){E.o.classList.add('hd');}
function sg(){if(s.af)cancelAnimationFrame(s.af);clearInterval(s.tm);D.querySelectorAll('.cf').forEach(c=>c.remove());s.lv=C.ml;s.qi=0;s.bp=0;s.ao.forEach(o=>o.el.remove());s.ao=[];s.rn=1;s.pa=0;s.lt=performance.now();uu(1);lq(0);ho();s.af=requestAnimationFrame(gl);s.tm=setInterval(spl,C.si);}
function tp(){if(!s.rn)return;s.pa=!s.pa;if(s.pa){clearInterval(s.tm);so(1);}else{ho();s.lt=performance.now();s.tm=setInterval(spl,C.si);s.af=requestAnimationFrame(gl);}}
function lq(i){if(i>=C.qs.length){wg();return;}const q=C.qs[i];E.qt.textContent=q.text;const b=D.getElementById('QB');b.style.animation='none';b.offsetHeight;b.style.animation='pi 0.5s';}
function gl(t){if(!s.rn||s.pa)return;const dt=(t-s.lt)/16;s.lt=t;uh(dt);uo(dt);s.af=requestAnimationFrame(gl);}
function uh(dt){const sp=C.hs*dt,r=E.c.getBoundingClientRect(),hw=E.h.offsetWidth;if(s.k.l){s.hx-=sp;s.hf=1;}if(s.k.r){s.hx+=sp;s.hf=0;}if(s.hx<0)s.hx=0;if(s.hx>r.width-hw)s.hx=r.width-hw;E.h.style.left=s.hx+"px";E.h.style.transform='scaleX('+(s.hf?-1:1)+')';}
function uo(dt){const gr=E.c.getBoundingClientRect(),hr=E.h.getBoundingClientRect(),hb={l:hr.left+20,r:hr.right-20,t:hr.top+30,b:hr.bottom};for(let i=s.ao.length-1;i>=0;i--){if(i>=s.ao.length)break;const o=s.ao[i];if(!o)continue;o.y+=o.sp*dt;o.el.style.top=o.y+"px";if(o.y>gr.height){o.el.remove();s.ao.splice(i,1);continue;}const or=o.el.getBoundingClientRect();if(or.right>hb.l&&or.left<hb.r&&or.bottom>hb.t&&or.top<hb.b){hc(o,i);if(s.ao.length===0)break;}}}
function spl(){if(!s.rn||s.pa)return;if(s.qi>=C.qs.length)return;const q=C.qs[s.qi];if(!q||!q.correct||q.correct.length===0)return;const r=Math.random();let t,tx,ic;
    let sum=0;
    if(r<(sum+=C.prob.l)){t='bl';} 
    else if(r<(sum+=C.prob.s)){t='bs';}
    else if(r<(sum+=C.prob.b)){t='b';}
    else if(r<(sum+=C.prob.c)){t='a';ic=1;tx=q.correct[Math.floor(Math.random()*q.correct.length)];}
    else{t='a';ic=0;tx=q.wrong[Math.floor(Math.random()*q.wrong.length)];}
    cfo(t,tx,ic);
}
function cfo(t,tx,ic){const el=D.createElement('div');el.classList.add('f');
    if(t==='b'){el.classList.add('is-bomb');el.style.backgroundImage='url("'+C.bi+'")';}
    else if(t==='bl'){el.classList.add('is-bonus');el.style.backgroundImage='url("'+C.bli+'")';}
    else if(t==='bs'){el.classList.add('is-bonus');el.style.backgroundImage='url("'+C.bsc+'")';}
    else{el.classList.add('is-answer');const bg = Math.random() < 0.5 ? C.i1 : C.i2;el.style.backgroundImage='url("'+bg+'")';const l=D.createElement('div');l.className='il';l.textContent=tx;el.appendChild(l);}
    const gw=E.c.offsetWidth,x=Math.random()*(gw-110)+20;el.style.left=x+"px";E.c.appendChild(el);s.ao.push({el:el,x:x,y:-100,sp:Number(C.fs)+Math.random()*1.5,type:t,ic:ic});
}
function hc(o,i){o.el.remove();s.ao.splice(i,1);const hr=E.h.getBoundingClientRect(),cx=hr.left+hr.width/2;
if(o.type==='b'){ps('b');td();ss();sft("-1 ‚ù§Ô∏è",cx,hr.top,"red");}
else if(o.type==='bl'){
    if(s.lv<C.ml){s.lv++;uu(1);sft("+1 ‚ù§Ô∏è",cx,hr.top,"#e84393");ps('life');}
    else{sft("MAX",cx,hr.top,"#ccc");ps('life');}
}
else if(o.type==='bs'){
    s.bp+=5;uu();sft("+5",cx,hr.top,"#fdcb6e");ps('bonus');
}
else{if(o.ic){ps('c');sft("–í–µ—Ä–Ω–æ!",cx,hr.top,"#4caf50");nl();}else{ps('w');td();sft("–û—à–∏–±–∫–∞!",cx,hr.top,"orange");}}}
function nl(){s.ao.forEach(o=>o.el.remove());s.ao=[];s.qi++;uu();if(s.qi>=C.qs.length){wg();}else{lq(s.qi);}}
function td(){s.lv--;uu();if(s.lv<=0)go();}
function uu(r=0){const c=E.l;if(r){c.innerHTML='';for(let i=0;i<s.lv;i++){const h=D.createElement('div');h.className='h';h.style.backgroundImage='url("'+C.li+'")';c.appendChild(h);}}else{const ch=c.querySelectorAll('.h:not(.br)'),ct=s.lv;if(ch.length>ct){for(let i=0;i<ch.length-ct;i++){const hb=ch[ch.length-1-i];if(hb){hb.classList.add('br');hb.addEventListener('animationend',()=>hb.remove(),{once:true});}}}}const p=C.qs.length>0?Math.min(100, (s.qi/C.qs.length)*100 + s.bp):0;E.pf.style.width=p+'%';}
function ss(){E.c.classList.remove('ss');void E.c.offsetWidth;E.c.classList.add('ss');}
function sft(t,x,y,c){const e=D.createElement('div');e.className='ft';e.textContent=t;e.style.color=c;e.style.left=x+"px";e.style.top=y+"px";D.body.appendChild(e);setTimeout(()=>e.remove(),1000);}
function go(){s.rn=0;if(s.af)cancelAnimationFrame(s.af);clearInterval(s.tm);so(2);}
function wg(){s.rn=0;if(s.af)cancelAnimationFrame(s.af);clearInterval(s.tm);E.pf.style.width='100%';so(3);}
function fc(){const c=['#d13447','#ffbf00','#263672','#7b2cbf','#8ac926','#1982c4'];for(let i=0;i<150;i++){const e=D.createElement('div');e.className='cf';e.style.backgroundColor=c[Math.floor(Math.random()*c.length)];e.style.left=Math.random()*100+'vw';const d=Math.random()*3+2;e.style.animation=\`cfa \${d}s linear forwards\`;e.style.animationDelay=Math.random()*2+'s';const s=Math.random()*10+5;e.style.width=s+'px';e.style.height=s*0.6+'px';E.c.appendChild(e);}}
function rs(){s.hx=(E.c.offsetWidth-100)/2;E.h.style.left=s.hx+"px";}

// –ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï
function setupMobile(){
    const mcl=D.getElementById('MCL');const mcr=D.getElementById('MCR');
    if(mcl){
        mcl.addEventListener('touchstart',e=>{e.preventDefault();s.k.l=1});
        mcl.addEventListener('touchend',e=>{e.preventDefault();s.k.l=0});
    }
    if(mcr){
        mcr.addEventListener('touchstart',e=>{e.preventDefault();s.k.r=1});
        mcr.addEventListener('touchend',e=>{e.preventDefault();s.k.r=0});
    }
}

function ev(){
    window.addEventListener('resize',rs);
    window.addEventListener('keydown',e=>{if(e.code==='Space')tp();if(e.code==='ArrowLeft'||e.code==='KeyA')s.k.l=1;if(e.code==='ArrowRight'||e.code==='KeyD')s.k.r=1;});
    window.addEventListener('keyup',e=>{if(e.code==='ArrowLeft'||e.code==='KeyA')s.k.l=0;if(e.code==='ArrowRight'||e.code==='KeyD')s.k.r=0;});
    E.pb.addEventListener('click',tp);
    setupMobile();
}
I();})();
<\/script></body></html>`;
    return html;
}
</script>
</body>
</html>
