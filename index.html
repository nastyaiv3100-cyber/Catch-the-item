<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Game Builder v3.2 (Genially Full Slide)</title>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&family=Lobster&family=Pacifico&family=Comfortaa:wght@400;700&family=Ruslan+Display&display=swap" rel="stylesheet">

  <style>
    :root { --primary:#e74c3c; --bg:#f5f7fa; --panel-w:420px; }
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family:'Roboto',sans-serif; height:100vh; display:flex; overflow:hidden; background:var(--bg); }

    .editor-panel { width:var(--panel-w); background:#fff; border-right:1px solid #ddd; display:flex; flex-direction:column; z-index:10; }
    .editor-header { padding:20px; background:#2c3e50; color:#fff; }
    .editor-header h2 { font-size:18px; margin:0; }

    .tabs { display:flex; background:#34495e; }
    .tab { flex:1; text-align:center; padding:12px; color:#bdc3c7; cursor:pointer; font-size:13px; border-bottom:3px solid transparent; transition:.2s; }
    .tab.active { color:#fff; border-bottom-color:var(--primary); background:#2c3e50; }

    .settings-content { flex:1; overflow-y:auto; padding:20px; }
    .section { display:none; }
    .section.active { display:block; }

    .form-group { margin-bottom:12px; }
    .form-group label { display:block; font-size:11px; font-weight:bold; color:#7f8c8d; margin-bottom:4px; text-transform:uppercase; }
    .form-group input[type="text"], .form-group input[type="number"], .form-group textarea, .form-group select {
      width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; font-size:14px;
    }
    .form-group input[type="color"] { width:100%; height:35px; border:1px solid #ddd; border-radius:4px; cursor:pointer; padding:2px; }
    .form-group input[type="range"] { width:100%; cursor:pointer; }
    .range-val { float:right; font-weight:bold; color:var(--primary); }
    .form-row { display:flex; gap:10px; }

    .q-item { background:#f8f9fa; border:1px solid #e9ecef; padding:10px; border-radius:6px; margin-bottom:10px; position:relative; }
    .btn-remove-q { position:absolute; top:5px; right:5px; color:red; cursor:pointer; font-size:18px; line-height:1; }
    .btn-add { width:100%; padding:10px; background:#eeffee; border:1px dashed #2ecc71; color:#27ae60; cursor:pointer; font-weight:bold; }

    .editor-footer { padding:20px; border-top:1px solid #ddd; background:#fff; }
    .btn-generate { width:100%; padding:15px; background:linear-gradient(135deg,#e74c3c,#c0392b); color:#fff; border:none; border-radius:6px; font-size:16px; font-weight:bold; cursor:pointer; box-shadow:0 4px 10px rgba(231,76,60,.3); }
    .btn-generate:hover { transform: translateY(-2px); }

    .preview-area { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; background:#e0e5ec; padding:20px; }
    #game-preview-container { width:960px; height:540px; background:#fff; box-shadow:0 20px 50px rgba(0,0,0,.2); border-radius:8px; overflow:hidden; }
    #game-frame { width:100%; height:100%; border:none; }

    .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,.8); z-index:1000; display:none; align-items:center; justify-content:center; }
    .code-modal { background:#fff; padding:30px; border-radius:8px; width:650px; max-width:92%; display:flex; flex-direction:column; gap:15px; }
    .code-modal textarea { width:100%; height:320px; font-family:monospace; padding:10px; font-size:12px; }
    .modal-btns { display:flex; justify-content:flex-end; gap:10px; }
  </style>
</head>

<body>
  <div class="editor-panel">
    <div class="editor-header"><h2>‚öô –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä v3.2 (Genially Full Slide)</h2></div>

    <div class="tabs">
      <div class="tab active" data-tab="content">–í–æ–ø—Ä–æ—Å—ã</div>
      <div class="tab" data-tab="graphics">–ì—Ä–∞—Ñ–∏–∫–∞</div>
      <div class="tab" data-tab="style">–°—Ç–∏–ª—å</div>
      <div class="tab" data-tab="text">–¢–µ–∫—Å—Ç—ã</div>
    </div>

    <div class="settings-content">
      <div id="tab-content" class="section active">
        <div id="questions-list"></div>
        <button class="btn-add" onclick="addQuestion()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
      </div>

      <div id="tab-graphics" class="section">
        <div class="form-group"><label>–ì–µ—Ä–æ–π (URL)</label><input type="text" id="img-hero" onchange="updatePreview()"></div>
        <div class="form-group"><label>–ë–æ–º–±–∞ (URL)</label><input type="text" id="img-bomb" onchange="updatePreview()"></div>
        <div class="form-group"><label>–ñ–∏–∑–Ω–∏ (GIF/IMG URL)</label><input type="text" id="img-life" onchange="updatePreview()"></div>
        <div class="form-row">
          <div class="form-group" style="flex:1"><label>–í–µ—Ä–Ω—ã–π (–§–æ–Ω)</label><input type="text" id="img-correct" onchange="updatePreview()"></div>
          <div class="form-group" style="flex:1"><label>–ù–µ–≤–µ—Ä–Ω—ã–π (–§–æ–Ω)</label><input type="text" id="img-wrong" onchange="updatePreview()"></div>
        </div>
      </div>

      <div id="tab-style" class="section">
        <div class="form-group" style="background:#fff0f0; padding:10px; border-radius:5px; border:1px solid #fadbd8;">
          <label style="color:#c0392b;">üöÄ –°–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è <span id="speed-display" class="range-val">2</span></label>
          <input type="range" id="conf-speed" min="1" max="10" step="0.5" value="2"
                 oninput="document.getElementById('speed-display').innerText=this.value; updatePreview()">
        </div>

        <div class="form-group">
          <label>–®—Ä–∏—Ñ—Ç –∏–≥—Ä—ã</label>
          <select id="font-family" onchange="updatePreview()">
            <option value="Roboto Condensed">Roboto Condensed</option>
            <option value="Open Sans">Open Sans</option>
            <option value="Lobster">Lobster</option>
            <option value="Pacifico">Pacifico</option>
            <option value="Comfortaa">Comfortaa</option>
            <option value="Ruslan Display">Ruslan Display</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group"><label>–†–∞–∑–º. –í–æ–ø—Ä–æ—Å–∞</label><input type="number" id="font-size-q" value="24" onchange="updatePreview()"></div>
          <div class="form-group"><label>–†–∞–∑–º. –û—Ç–≤–µ—Ç–∞</label><input type="number" id="font-size-a" value="18" onchange="updatePreview()"></div>
        </div>

        <div class="form-group"><label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏ / –∫–Ω–æ–ø–æ–∫</label><input type="color" id="col-border" value="#ffcc00" onchange="updatePreview()"></div>

        <hr style="margin:10px 0; border:0; border-top:1px solid #eee;">

        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ (–û—Ç–≤–µ—Ç)</label>
            <input type="color" id="col-lbl-text" value="#ffffff" onchange="updatePreview()">
          </div>
          <div class="form-group" style="flex:1">
            <label>–§–æ–Ω —Ç–µ–∫—Å—Ç–∞ (–û—Ç–≤–µ—Ç)</label>
            <input type="color" id="col-lbl-bg" value="#000000" onchange="updatePreview()">
          </div>
        </div>

        <hr style="margin:10px 0; border:0; border-top:1px solid #eee;">

        <div class="form-row">
          <div class="form-group" style="flex:1"><label>–ü—Ä–æ–≥—Ä–µ—Å—Å (–°—Ç–∞—Ä—Ç)</label><input type="color" id="col-prog-1" value="#ffd700" onchange="updatePreview()"></div>
          <div class="form-group" style="flex:1"><label>–ü—Ä–æ–≥—Ä–µ—Å—Å (–ö–æ–Ω–µ—Ü)</label><input type="color" id="col-prog-2" value="#ffa500" onchange="updatePreview()"></div>
        </div>
      </div>

      <div id="tab-text" class="section">
        <div class="form-group"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label><input type="text" id="txt-title" value="–ü–∞–¥–∞—é—â–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã" onchange="updatePreview()"></div>
        <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea id="txt-desc" rows="2" onchange="updatePreview()">–õ–æ–≤–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –∏–∑–±–µ–≥–∞–π –±–æ–º–±!</textarea></div>
        <div class="form-group"><label>–¢–µ–∫—Å—Ç –ü–æ–±–µ–¥—ã</label><input type="text" id="txt-win" value="–ü–æ–±–µ–¥–∞!" onchange="updatePreview()"></div>
        <div class="form-group"><label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ü–æ–±–µ–¥—ã</label><input type="text" id="txt-win-sub" value="–í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ–π–¥–µ–Ω—ã!" onchange="updatePreview()"></div>
        <div class="form-group"><label>–¢–µ–∫—Å—Ç –ü—Ä–æ–∏–≥—Ä—ã—à–∞</label><input type="text" id="txt-lose" value="–û–π!" onchange="updatePreview()"></div>
        <div class="form-group"><label>–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –ü—Ä–æ–∏–≥—Ä—ã—à–∞</label><input type="text" id="txt-lose-sub" value="–ñ–∏–∑–Ω–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å." onchange="updatePreview()"></div>
      </div>
    </div>

    <div class="editor-footer">
      <button class="btn-generate" onclick="generateCode()">üöÄ –ö–û–ü–ò–†–û–í–ê–¢–¨ –ö–û–î</button>
    </div>
  </div>

  <div class="preview-area">
    <div id="game-preview-container"><iframe id="game-frame"></iframe></div>
  </div>

  <div id="modal-code" class="modal-overlay">
    <div class="code-modal">
      <h3>–ì–æ—Ç–æ–≤—ã–π –∫–æ–¥ –¥–ª—è Genially (–Ω–∞ –≤–µ—Å—å —Å–ª–∞–π–¥)</h3>
      <p>–í Genially –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Ç—è–Ω–∏ –æ–±—ä–µ–∫—Ç —Å —ç—Ç–∏–º HTML –Ω–∞ –≤–µ—Å—å —Å–ª–∞–π–¥ (16:9). –ö–æ–¥ —É–∂–µ –±–µ–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –±–µ–∑ ‚Äú—É–µ–∑–¥–∞ –≤–ø—Ä–∞–≤–æ‚Äù.</p>
      <textarea id="final-code" readonly></textarea>
      <div class="modal-btns">
        <button onclick="document.getElementById('modal-code').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button onclick="copyToClipboard()"
                style="background:#e74c3c; color:#fff; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">
          –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
        </button>
      </div>
    </div>
  </div>

  <script>
    const defaultData = {
      hero: "https://img.genially.com/684ea2da1b51060014c50e97/ea80b435-14c0-4490-b057-d9b367d6d8b8.png",
      bomb: "https://img.genially.com/684ea2da1b51060014c50e97/1100a032-bbfa-469f-aa6c-454364216500.png",
      life: "https://img.genially.com/684ea2da1b51060014c50e97/56159391-2288-48d7-8264-2e7f0aa2f799.gif",
      giftC: "https://img.genially.com/684ea2da1b51060014c50e97/6caada9a-c539-4f5d-952c-c63df7c459f4.png",
      giftW: "https://img.genially.com/684ea2da1b51060014c50e97/152eafba-7d36-41e3-9026-b78a900821bd.png",
      questions: [
        { t: "–ö–∞–∫–æ–π —Å–µ–π—á–∞—Å –≥–æ–¥?", c: "2026", w: "2025, 2024" },
        { t: "–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏?", c: "–ü–∞—Ä–∏–∂", w: "–†–∏–º, –ë–µ—Ä–ª–∏–Ω" }
      ]
    };

    const fontMap = {
      "Roboto Condensed": "https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap",
      "Open Sans": "https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap",
      "Lobster": "https://fonts.googleapis.com/css2?family=Lobster&display=swap",
      "Pacifico": "https://fonts.googleapis.com/css2?family=Pacifico&display=swap",
      "Comfortaa": "https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap",
      "Ruslan Display": "https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap"
    };

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });

    window.onload = function() {
      document.getElementById('img-hero').value = defaultData.hero;
      document.getElementById('img-bomb').value = defaultData.bomb;
      document.getElementById('img-life').value = defaultData.life;
      document.getElementById('img-correct').value = defaultData.giftC;
      document.getElementById('img-wrong').value = defaultData.giftW;

      defaultData.questions.forEach(q => addQuestion(q.t, q.c, q.w));
      updatePreview();
    };

    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabId));
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById('tab-' + tabId).classList.add('active');
    }

    function addQuestion(text="", cor="", wr="") {
      const div = document.createElement('div');
      div.className = 'q-item';
      div.innerHTML = `
        <div class="btn-remove-q" title="–£–¥–∞–ª–∏—Ç—å">√ó</div>
        <input type="text" class="q-text" placeholder="–í–æ–ø—Ä–æ—Å" value="${escapeHtml(text)}" onchange="updatePreview()">
        <div class="form-row">
          <input type="text" class="q-correct" placeholder="–í–µ—Ä–Ω–æ (–º–æ–∂–Ω–æ: 8, –≤–æ—Å–µ–º—å)" value="${escapeHtml(cor)}" style="border-color:#2ecc71" onchange="updatePreview()">
          <input type="text" class="q-wrong" placeholder="–ù–µ–≤–µ—Ä–Ω–æ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" value="${escapeHtml(wr)}" style="border-color:#e74c3c" onchange="updatePreview()">
        </div>
      `;
      div.querySelector('.btn-remove-q').onclick = () => { div.remove(); updatePreview(); };
      document.getElementById('questions-list').appendChild(div);
      updatePreview();
    }

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function getConfig() {
      const qs = [];
      document.querySelectorAll('.q-item').forEach(item => {
        const t = item.querySelector('.q-text').value;
        const c = item.querySelector('.q-correct').value.split(',').map(s=>s.trim()).filter(Boolean);
        const w = item.querySelector('.q-wrong').value.split(',').map(s=>s.trim()).filter(Boolean);
        if(t) qs.push({ text: t, correct: c, wrong: w });
      });

      return {
        speed: document.getElementById('conf-speed').value,
        hero: document.getElementById('img-hero').value,
        bomb: document.getElementById('img-bomb').value,
        life: document.getElementById('img-life').value,
        giftC: document.getElementById('img-correct').value,
        giftW: document.getElementById('img-wrong').value,
        questions: qs,
        fontName: document.getElementById('font-family').value,
        sizeQ: document.getElementById('font-size-q').value,
        sizeA: document.getElementById('font-size-a').value,
        colBorder: document.getElementById('col-border').value,
        colProg1: document.getElementById('col-prog-1').value,
        colProg2: document.getElementById('col-prog-2').value,
        colLblText: document.getElementById('col-lbl-text').value,
        colLblBg: document.getElementById('col-lbl-bg').value,
        txtTitle: document.getElementById('txt-title').value,
        txtDesc: document.getElementById('txt-desc').value,
        txtWin: document.getElementById('txt-win').value,
        txtWinSub: document.getElementById('txt-win-sub').value,
        txtLose: document.getElementById('txt-lose').value,
        txtLoseSub: document.getElementById('txt-lose-sub').value,
      };
    }

    function updatePreview() {
      const config = getConfig();
      const gameCode = buildGameHTML(config, false);
      const frame = document.getElementById('game-frame');
      frame.src = URL.createObjectURL(new Blob([gameCode], { type: 'text/html' }));
    }

    function generateCode() {
      const config = getConfig();
      const code = buildGameHTML(config, true);
      document.getElementById('final-code').value = code;
      document.getElementById('modal-code').style.display = 'flex';
    }

    function copyToClipboard() {
      const copyText = document.getElementById("final-code");
      copyText.select();
      document.execCommand("copy");
      alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
    }

    // ===== GAME CODE: –±–µ–∑ scale, –≤—Å–µ–≥–¥–∞ 100%√ó100%, –±–µ–∑ "—É–µ–∑–¥–∞" =====
    function buildGameHTML(cfg, minify) {
      const qJSON = JSON.stringify(cfg.questions);
      const fontUrl = fontMap[cfg.fontName] || fontMap["Open Sans"];

      let html = `
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="${fontUrl}" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0;user-select:none}
html,body{width:100%;height:100%;overflow:hidden;background:transparent;font-family:'${cfg.fontName}',sans-serif}

/* –í–ê–ñ–ù–û: –Ω–∏–∫–∞–∫–∏—Ö 100vw/100vh ‚Äî —Ç–æ–ª—å–∫–æ inset:0 */
#GC{position:absolute;inset:0;overflow:hidden}
:root{--bc:${cfg.colBorder};--p1:${cfg.colProg1};--p2:${cfg.colProg2};--fq:${cfg.sizeQ}px;--fa:${cfg.sizeA}px;--cl:${cfg.colLblText};--cbg:${cfg.colLblBg}}
#UI{position:absolute;inset:0 auto auto 0;width:100%;padding:15px;z-index:10;display:flex;flex-direction:column;gap:10px;pointer-events:none}
.tb{display:flex;align-items:center;justify-content:center;gap:15px;pointer-events:auto}
#PB{width:40px;height:40px;border-radius:50%;border:2px solid #fff;background:var(--bc);color:#333;font-weight:700;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 5px rgba(0,0,0,.3);transition:transform .1s}
#PB:active{transform:scale(.9)}
.pc{flex-grow:1;max-width:600px;height:20px;background:rgba(0,0,0,.5);border:2px solid rgba(255,255,255,.8);border-radius:10px;overflow:hidden}
.pf{height:100%;background:linear-gradient(90deg,var(--p1),var(--p2));width:0%;transition:width .5s ease}
#QB{background:#ffffff;
  border:4px solid var(--bc);           /* ‚Üê –ñ–Å–õ–¢–ê–Ø –†–ê–ú–ö–ê */
  border-radius:18px;
  padding:18px 24px;
  text-align:center;
  max-width:820px;
  margin:0 auto;

  /* –í–ê–ñ–ù–û: –¥–µ–ª–∞–µ–º —Ä–∞–º–∫—É "—á—ë—Ç–∫–æ–π" */
  box-sizing:border-box;
  outline:2px solid rgba(255,204,0,0.35); /* –º—è–≥–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –∂—ë–ª—Ç—ã–º */
  outline-offset:0;

  box-shadow:
    0 10px 25px rgba(0,0,0,.25),
    0 0 0 2px rgba(255,204,0,.15);

  pointer-events:auto;
  animation:pi .5s;
}
#QT{font-size:var(--fq);color:#333;font-weight:900}
#LB{position:absolute;top:20px;right:20px;display:flex;gap:10px;pointer-events:none}
.h{width:50px;height:50px;background-size:contain;background-repeat:no-repeat;background-position:center;display:inline-block;transition:transform .3s ease;filter:drop-shadow(0 2px 2px rgba(0,0,0,.3))}
.h.br{animation:hba 2.5s forwards ease-out;z-index:100;position:relative}
@keyframes hba{0%{transform:scale(1);opacity:1;filter:brightness(1)}10%{transform:scale(1.1) rotate(-5deg);filter:brightness(2) sepia(1)}100%{transform:translateY(-150px) scale(1.2) rotate(-20deg);opacity:0;filter:blur(10px) grayscale(1)}}
#H{position:absolute;bottom:30px;width:150px;height:190px;background-repeat:no-repeat;background-position:center;background-size:contain;transform-origin:center bottom;transition:transform .1s linear;z-index:5}
.f{position:absolute;top:-100px;display:flex;justify-content:center;align-items:center;background-size:contain;background-repeat:no-repeat;background-position:center;will-change:top;z-index:4}
.il{background:var(--cbg);color:var(--cl);padding:4px 8px;border-radius:4px;font-size:var(--fa);font-weight:900;white-space:nowrap;margin-top:-60px;text-shadow:0 0 2px #000;border:1px solid rgba(255,255,255,.3)}
.cf{position:absolute;width:10px;height:10px;top:-10px;z-index:25;pointer-events:none;opacity:0}
@keyframes cfa{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
.ss{animation:sha .5s}
@keyframes sha{0%{transform:translate(1px,1px) rotate(0deg)}10%{transform:translate(-1px,-2px) rotate(-1deg)}30%{transform:translate(3px,2px) rotate(0deg)}50%{transform:translate(-1px,2px) rotate(-1deg)}70%{transform:translate(3px,1px) rotate(-1deg)}90%{transform:translate(1px,2px) rotate(0deg)}100%{transform:translate(1px,-2px) rotate(-1deg)}}
.ov{position:absolute;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:20;opacity:1;transition:opacity .3s}
.ov.hd{opacity:0;pointer-events:none}
.md{background:#fff;padding:30px;border-radius:20px;text-align:center;max-width:420px;border:4px solid var(--bc);box-shadow:0 0 30px rgba(0,0,0,.5)}
.md h1{color:#333;margin-bottom:10px}.md p{color:#555;font-size:18px;margin-bottom:20px;white-space:pre-line}
button.bp{background:linear-gradient(to bottom,var(--bc),#ff9900);border:none;padding:12px 30px;font-size:20px;border-radius:30px;cursor:pointer;font-weight:1000;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.3);transition:transform .1s}
button.bp:active{transform:scale(.95)}
.ft{position:absolute;font-weight:1000;font-size:24px;pointer-events:none;animation:fu 1s forwards;z-index:15;text-shadow:2px 2px 0 #000}
@keyframes fu{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-50px)}}
@keyframes pi{0%{transform:scale(.8);opacity:0}100%{transform:scale(1);opacity:1}}
</style>
</head>
<body>
<div id="GC">
  <div id="UI">
    <div class="tb">
      <button id="PB">||</button>
      <div class="pc"><div id="PF" class="pf"></div></div>
    </div>
    <div id="LB"></div>
    <div id="QB"><div id="QT">...</div></div>
  </div>

  <div id="H"></div>

  <div id="OS" class="ov"><div class="md"><h1>${escapeHtml(cfg.txtTitle)}</h1><p>${escapeHtml(cfg.txtDesc)}</p><button class="bp" id="BS">–ò–ì–†–ê–¢–¨</button></div></div>
  <div id="OP" class="ov hd"><div class="md"><h1>–ü–∞—É–∑–∞</h1><p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p><button class="bp" id="BR">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button></div></div>
  <div id="OG" class="ov hd"><div class="md"><h1 style="color:#d9534f">${escapeHtml(cfg.txtLose)}</h1><p>${escapeHtml(cfg.txtLoseSub)}</p><button class="bp" id="BRe">–ï–©–ï –†–ê–ó</button></div></div>
  <div id="OW" class="ov hd"><div class="md"><h1 style="color:#5cb85c">${escapeHtml(cfg.txtWin)}</h1><p>${escapeHtml(cfg.txtWinSub)}</p><button class="bp" id="BRst">–ï–©–Å –†–ê–ó</button></div></div>
</div>

<audio id="SC" src=""></audio><audio id="SW" src=""></audio><audio id="SWin" src=""></audio><audio id="SL" src=""></audio>

<script>
const G={li:"${cfg.life}",hi:"${cfg.hero}",bi:"${cfg.bomb}",gc:"${cfg.giftC}",gw:"${cfg.giftW}",hs:6,fs:${cfg.speed},si:900,ml:3,qs:${qJSON}};
let st={run:0,pau:0,q:0,l:G.ml,hx:0,hf:0,ao:[],lt:0,tm:0,af:0,k:{l:0,r:0}};
const E={c:document.getElementById('GC'),h:document.getElementById('H'),lc:document.getElementById('LB'),qt:document.getElementById('QT'),pf:document.getElementById('PF'),
ov:{s:document.getElementById('OS'),p:document.getElementById('OP'),g:document.getElementById('OG'),w:document.getElementById('OW')},
b:{p:document.getElementById('PB'),r:document.getElementById('BR')}};

function init(){E.h.style.backgroundImage=\`url("\${G.hi}")\`;sl();rs();uu(1);}
function sg(){if(st.af)cancelAnimationFrame(st.af);clearInterval(st.tm);document.querySelectorAll('.cf').forEach(c=>c.remove());st.l=G.ml;st.q=0;st.ao.forEach(o=>o.el.remove());st.ao=[];st.run=1;st.pau=0;st.lt=performance.now();uu(1);lq(0);ho();st.af=requestAnimationFrame(gl);st.tm=setInterval(spl,G.si);}
function tp(){if(!st.run)return;st.pau=!st.pau;if(st.pau){clearInterval(st.tm);E.ov.p.classList.remove('hd');}else{E.ov.p.classList.add('hd');st.lt=performance.now();st.tm=setInterval(spl,G.si);st.af=requestAnimationFrame(gl);}}
function lq(i){if(i>=G.qs.length){wg();return;}const q=G.qs[i];E.qt.textContent=q.text;const b=document.getElementById('QB');b.style.animation='none';b.offsetHeight;b.style.animation='pi .5s';}
function gl(t){if(!st.run||st.pau)return;const dt=(t-st.lt)/16;st.lt=t;uh(dt);uo(dt);st.af=requestAnimationFrame(gl);}
function uh(dt){const s=G.hs*dt,r=E.c.getBoundingClientRect(),hw=E.h.offsetWidth;if(st.k.l){st.hx-=s;st.hf=1;}if(st.k.r){st.hx+=s;st.hf=0;}if(st.hx<0)st.hx=0;if(st.hx>r.width-hw)st.hx=r.width-hw;E.h.style.left=st.hx+"px";E.h.style.transform=\`scaleX(\${st.hf?-1:1})\`;}
function uo(dt){const gr=E.c.getBoundingClientRect(),hr=E.h.getBoundingClientRect(),hb={l:hr.left+20,r:hr.right-20,t:hr.top+30,b:hr.bottom};for(let i=st.ao.length-1;i>=0;i--){if(i>=st.ao.length)break;const o=st.ao[i];if(!o)continue;o.y+=o.speed*dt;o.el.style.top=o.y+"px";if(o.y>gr.height){o.el.remove();st.ao.splice(i,1);continue;}const or=o.el.getBoundingClientRect();if(or.right>hb.l&&or.left<hb.r&&or.bottom>hb.t&&or.top<hb.b){hc(o,i);if(st.ao.length===0)break;}}}
function spl(){if(!st.run||st.pau)return;if(st.q>=G.qs.length)return;const q=G.qs[st.q];if(!q)return;const r=Math.random();let t,tx,ic;if(r<.1){t='b';}else if(r<.5){t='a';ic=1;tx=q.correct[Math.floor(Math.random()*q.correct.length)]||"";}else{t='a';ic=0;tx=q.wrong[Math.floor(Math.random()*q.wrong.length)]||"";}cfo(t,tx,ic);}
function cfo(t,tx,ic){const el=document.createElement('div');el.classList.add('f');const gw=E.c.offsetWidth,x=Math.random()*(gw-110)+20;el.style.left=x+"px";el.style.width="70px";el.style.height="70px";if(t==='b'){el.style.backgroundImage=\`url("\${G.bi}")\`;}else{el.style.backgroundImage=\`url("\${ic?G.gc:G.gw}")\`;const l=document.createElement('div');l.className='il';l.textContent=tx;el.appendChild(l);}E.c.appendChild(el);st.ao.push({el:el,x:x,y:-100,speed:Number(G.fs)+Math.random()*1.5,type:t,ic:ic});}
function hc(o,i){o.el.remove();st.ao.splice(i,1);const hr=E.h.getBoundingClientRect(),cx=hr.left+hr.width/2;if(o.type==='b'){ps('SW');td();ss();sft("-1 ‚ù§Ô∏è",cx,hr.top,"red");}else{if(o.ic){ps('SC');sft("–í–µ—Ä–Ω–æ!",cx,hr.top,"#4caf50");nl();}else{ps('SW');td();sft("–û—à–∏–±–∫–∞!",cx,hr.top,"orange");}}}
function nl(){st.ao.forEach(o=>o.el.remove());st.ao=[];st.q++;uu();if(st.q>=G.qs.length){wg();}else{lq(st.q);}}
function td(){st.l--;uu();if(st.l<=0)go();}
function uu(r=0){const c=E.lc;if(r){c.innerHTML='';for(let i=0;i<st.l;i++){const h=document.createElement('div');h.className='h';h.style.backgroundImage=\`url("\${G.li}")\`;c.appendChild(h);}}else{const ch=c.querySelectorAll('.h:not(.br)'),ct=st.l;if(ch.length>ct){for(let i=0;i<ch.length-ct;i++){const hb=ch[ch.length-1-i];if(hb){hb.classList.add('br');hb.addEventListener('animationend',()=>hb.remove(),{once:true});}}}}const p=G.qs.length>0?(st.q/G.qs.length)*100:0;E.pf.style.width=\`\${p}%\`;}
function ss(){E.c.classList.remove('ss');void E.c.offsetWidth;E.c.classList.add('ss');}
function sft(t,x,y,c){const e=document.createElement('div');e.className='ft';e.textContent=t;e.style.color=c;e.style.left=x+"px";e.style.top=y+"px";document.body.appendChild(e);setTimeout(()=>e.remove(),1000);}
function ps(i){const a=document.getElementById(i);if(a&&a.src)a.currentTime=0;}
function go(){st.run=0;if(st.af)cancelAnimationFrame(st.af);clearInterval(st.tm);ps('SL');E.ov.g.classList.remove('hd');}
function wg(){st.run=0;if(st.af)cancelAnimationFrame(st.af);clearInterval(st.tm);ps('SWin');E.pf.style.width='100%';E.ov.w.classList.remove('hd');fc();}
function fc(){const c=['#d13447','#ffbf00','#263672','#7b2cbf','#8ac926','#1982c4'];for(let i=0;i<150;i++){const e=document.createElement('div');e.className='cf';e.style.backgroundColor=c[Math.floor(Math.random()*c.length)];e.style.left=Math.random()*100+'vw';const d=Math.random()*3+2;e.style.animation=\`cfa \${d}s linear forwards\`;e.style.animationDelay=Math.random()*2+'s';const s=Math.random()*10+5;e.style.width=s+'px';e.style.height=s*.6+'px';E.c.appendChild(e);}}
function ho(){Object.values(E.ov).forEach(e=>e.classList.add('hd'));}
function rs(){st.hx=(E.c.offsetWidth-100)/2;E.h.style.left=st.hx+"px";}
function sl(){window.addEventListener('resize',rs);window.addEventListener('keydown',e=>{if(e.code==='Space')tp();if(e.code==='ArrowLeft'||e.code==='KeyA')st.k.l=1;if(e.code==='ArrowRight'||e.code==='KeyD')st.k.r=1;});window.addEventListener('keyup',e=>{if(e.code==='ArrowLeft'||e.code==='KeyA')st.k.l=0;if(e.code==='ArrowRight'||e.code==='KeyD')st.k.r=0;});document.getElementById('BS').addEventListener('click',sg);document.getElementById('BRe').addEventListener('click',sg);document.getElementById('BRst').addEventListener('click',sg);E.b.p.addEventListener('click',tp);E.b.r.addEventListener('click',tp);}
init();
<\/script>
</body>
</html>`;

      if (minify) return html.replace(/\n/g,'').replace(/\s+/g,' ').replace(/> </g,'><').trim();
      return html;
    }
  </script>
</body>
</html>
